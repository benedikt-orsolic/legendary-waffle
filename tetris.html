<!DOCTYPE HTML>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Snake</title>

</head>



<script>

  var dropedPieces = undefined;
  var currentPiece = undefined;
  var currentPieceCenter = undefined;
  var nextPiece = undefined;
  var loopVar = undefined;

  //To test new code manually
  function startGame(dir) {
    currentPiece = getT(dir);
    currentPieceCenter = {x:2, y:0};
    setUp();
    dropedPieces[2][10] = 1;
    loopVar = setInterval(gameLoop, 500);
  }



  async function gameLoop() {

    currentPieceCenter.y += 1;
    render();
    
    if( lowestPartInContact() ) {
      
      addCurrentToDropedPieces();
      setNewCurrentPiece();
    } 
    //console.log(currentPieceCenter.y.toString());
  }

  function lowestPartInContact() {
    for (b of currentPiece) {
    
     if ( b.y + currentPieceCenter.y >= 24) return 1;

    }
    return 0;
  }
  
  function setNewCurrentPiece() {
    currentPiece = nextPiece;
    currentPieceCenter = {x:5, y:0};
    nextPiece = getT(0);

  }
  
  function addCurrentToDropedPieces() {
    for (b of currentPiece) {
      dropedPieces[b.x + currentPieceCenter.x][b.y + currentPieceCenter.y] = 1;
    }
  }
  
  function render() {
    document.getElementById("game-grid").innerHTML = "";

    for (b of currentPiece) {
      
      document.getElementById("game-grid").innerHTML +=
      '<div class="block" style="grid-column: ' + String(currentPieceCenter.x + b.x + 1) +
      ' / span 1; grid-row: ' + String(currentPieceCenter.y + b.y + 1) + ' / span 1;"></div>';
    }
    
    for (var i=0; i < 10; i++) {
      for (var j=0; j < 25; j++) {
        if( dropedPieces[i][j] == 1 )
          document.getElementById("game-grid").innerHTML +=
          '<div class="block" style="grid-column: ' + String(i + 1) +
          ' / span 1; grid-row: ' + String(j + 1) + ' / span 1;"></div>';

      }
    }
    
  }

  function setUp() {
    nextPiece = getT(0);
    //Init dropedPieces 2D Array
    dropedPieces = new Array(10);
    for (var i=0; i<10; i++) {
      dropedPieces[i] = new Array(25).map(function () { return 0; });
    }
  }

  function getT(direction) {
    switch (direction) {
      case 0:
        return [{x: 0,y: 0},{x: -1,y: 0},{x:1, y:0}, {x:0, y:-1}];
      case 1:
        return [{x:0, y:0}, {x: 0, y:-1}, {x:0, y:1}, {x:-1,y:0}];
      case 2:
        return [{x:0, y:0}, {x:-1, y:0}, {x:1, y:0}, {x:0, y:1}];
      case 3:
        return [{x:0, y:0}, {x:0, y:-1}, {x:0, y:1}, {x:1, y:0}];
    }
  }
</script>



<body>
  <div id="game-grid">
    <div class="block" style="grid-row: 20 / span 1; grid-column: 10 / span 1;"></div>
  </div>
  <div id="preview-grid"></div>
  <button onclick="startGame(0)">render</button>
</body>



<style>
  body {
    margin: 0;
    padding: 0;
  }

  #game-grid {
    display: grid;
    height: 100vw;
    width: 40vw;

    grid-template-columns: repeat(10, 4vw);
    grid-template-rows: repeat(25, 4vw);
    grid-column-gap: 0;
    grid-row-gap: 0;

    background-color: #505050;

    overflow: hidden;

  }

  #preview-grid {

    width: 16vw;
    height: 16vw;
    grid-template-columns: repeat(4, 4vw);
    grid-template-rows: repeat(4,4vw);
    grid-column-gap: 0;
    grid-row-gap: 0;

    background-color: blue;
  }

  .block {
    background-color: blue;
    height: 2vw;
    width: 2vw;
    border: 1vw solid white;
    padding: 0;
  }
</style>

</html>