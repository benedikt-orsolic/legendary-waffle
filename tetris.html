<!DOCTYPE HTML>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Snake</title>

</head>



<script>
  class Piece{
    //add track of which piece 
    //? function pointer
    
    //this.arr = undefined; // Stores arr of coordinates
    //this.rot = undefined; // Which way its pointing
    //this.cen = undefined; //What is center of rotation
    
    constructor(){
      // Will create new random piece later
      this.rot = 0;
      this.arr = this.getT();
      this.cen = {x:5, y:0};
    }
    
    getT() {
      switch ( this.rot ) {
        case 0:
         return [{x: 0,y: 0},{x: -1,y: 0},{x:1, y:0}, {x:0, y:-1}];
        case 1:
          return [{x:0, y:0}, {x: 0, y:-1}, {x:0, y:1}, {x:-1,y:0}];
        case 2:
          return [{x:0, y:0}, {x:-1, y:0}, {x:1, y:0}, {x:0, y:1}];
        case 3:
          return [{x:0, y:0}, {x:0, y:-1}, {x:0, y:1}, {x:1, y:0}];
      }
    }
    
    cw(){
      this.rot -= 1;
      this.rot = this.rot < 0 ? 3 : this.rot;
      this.arr = this.getT();
    }
    
    ccw(){
      this.rot += 1;
      this.rot = this.rot > 3 ? 0 : this.rot;
      this.arr = this.getT();
    }
    
    
    
  }
  
  
  var dropedPieces = undefined;
  
  var cPiece = undefined;  //Current
  var nPiece = undefined;  //Next
  
  //
  var loopVar = undefined;

  //To test new code manually
  function startGame(dir) {
    setUp();
    loopVar = setInterval(gameLoop, 100);
  }

  async function gameLoop() {

    cPiece.cen.y += 1;
    render();
    
    if( lowestPartInContact() ) {
      
      addCurrentToDropedPieces();
      setNewCurrentPiece();
    } 
    //console.log(currentPieceCenter.y.toString());
  }

  function lowestPartInContact() {
    for (b of cPiece.arr) {
    
     if ( b.y + cPiece.cen.y >= 24 ||
          dropedPieces[b.x + cPiece.cen.x][b.y + cPiece.cen.y + 1] == 1) return 1;

    }
    return 0;
  }
  
  function setNewCurrentPiece() {
    cPiece = nPiece;
    nPiece = Piece();
  }
  
  function addCurrentToDropedPieces() {
    for (b of cPiece.arr) {
      dropedPieces[b.x + cPiece.cen.x][b.y + cPiece.cen.y] = 1;
    }
  }
  
  function render() {
    document.getElementById("game-grid").innerHTML = "";

    for (b of cPiece.arr) {
      
      document.getElementById("game-grid").innerHTML +=
      '<div class="block" style="grid-column: ' + String(cPiece.cen.x + b.x + 1) +
      ' / span 1; grid-row: ' + String(cPiece.cen.y + b.y + 1) + ' / span 1;"></div>';
    }
    
    for (var i=0; i < 10; i++) {
      for (var j=0; j < 25; j++) {
        if( dropedPieces[i][j] == 1 )
          document.getElementById("game-grid").innerHTML +=
          '<div class="block" style="grid-column: ' + String(i + 1) +
          ' / span 1; grid-row: ' + String(j + 1) + ' / span 1;"></div>';

      }
    }
    
  }

  function setUp() {
    nPiece = new Piece ();
    cPiece = new Piece ();
    
    //Init dropedPieces 2D Array
    dropedPieces = new Array(10);
    for (var i=0; i<10; i++) {
      dropedPieces[i] = new Array(25).map(function () { return 0; });
    }
  }
  
  

  
</script>



<body>
  <div id="game-grid">
    <div class="block" style="grid-row: 20 / span 1; grid-column: 10 / span 1;"></div>
  </div>
  <div id="preview-grid"></div>
  <button onclick="startGame(0)">render</button>
  <button onclick="cPiece.ccw()">CCW</button>
  <button onclick="cPiece.cw()">CW</button>
</body>



<style>
  body {
    margin: 0;
    padding: 0;
  }

  #game-grid {
    display: grid;
    height: 100vw;
    width: 40vw;

    grid-template-columns: repeat(10, 4vw);
    grid-template-rows: repeat(25, 4vw);
    grid-column-gap: 0;
    grid-row-gap: 0;

    background-color: #505050;

    overflow: hidden;

  }

  #preview-grid {

    width: 16vw;
    height: 16vw;
    grid-template-columns: repeat(4, 4vw);
    grid-template-rows: repeat(4,4vw);
    grid-column-gap: 0;
    grid-row-gap: 0;

    background-color: blue;
  }

  .block {
    background-color: blue;
    height: 2vw;
    width: 2vw;
    border: 1vw solid white;
    padding: 0;
  }
</style>

</html>